<!doctype html>
<html><head>
<meta charset="utf-8"><title>Admin â€” Odrop</title>
<link rel="stylesheet" href="style.css">
<script src="main.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js" defer></script>
<script>
const ADMIN_EMAILJS_SERVICE = 'service_8pofbon';
const ADMIN_TEMPLATE_APPROVE = 'template_listing_approved'; // <-- create and replace
document.addEventListener('DOMContentLoaded', ()=> {
  emailjs.init('mqnVOPu2ysfQu72il');
  const all = odrop.getAllListings();
  const container = document.getElementById('listings');
  if(!all.length) container.textContent = 'No listings';
  all.forEach(l => {
    const el = document.createElement('div');
    el.className = 'listing-card';
    el.innerHTML = `<h3>${l.title} ${l.approved ? '(approved)':''}</h3>
      <p>${l.description}</p>
      <p>Price: ${l.price} ${l.currency}</p>
      <p>Owner: ${l.owner} <small>(${l.reply_to||''})</small></p>
      <button data-id="${l.id}" ${l.approved ? 'disabled':''}>Approve</button>`;
    container.appendChild(el);
    el.querySelector('button').addEventListener('click', async (e)=>{
      const id = e.target.dataset.id;
      odrop.approveListing(id);
      e.target.disabled = true;
      // notify seller via EmailJS
      const listing = odrop.getAllListings().find(x=>x.id===id);
      try {
        await emailjs.send(ADMIN_EMAILJS_SERVICE, ADMIN_TEMPLATE_APPROVE, {
          to_email: listing.reply_to,
          listing_title: listing.title,
          seller: listing.owner
        });
        alert('Approved and email sent');
      } catch(err) { alert('Approved but email failed'); }
    });
  });
});
</script>
</head>
<body>
  <main style="max-width:900px;margin:50px auto">
    <h1>Admin - Listings</h1>
    <div id="listings"></div>
  </main>
</body></html>

